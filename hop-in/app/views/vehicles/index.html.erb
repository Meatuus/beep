<%= link_to 'Add Your Vehicle', new_vehicle_path %> | <%= link_to 'Profile', users_path %> 

<h1>Available Vehicles</h1>

<% @vehicles.each do |vehicle| %>
	<article class="">
		<h2><%= vehicle.owner.first_name %> - <%= vehicle.vehicle_year %> <%= vehicle.vehicle_make %> <%= vehicle.vehicle_model %></h2>
		<h3>Seats: <%= vehicle.seats %></h3>
		<h3>Address: <span class="vehicle-address"><%= vehicle.street_address %>, <%= vehicle.city %></span></h3>
	</article>
<% end %>


<h3>My Google Maps Demo</h3>
<div id="map"></div>

<% vehicles = [] %>
<% @vehicles.each do |vehicle| %>
	<% vehicle = [vehicle.street_address, vehicle.city, vehicle.province] %>
	<% vehicles << vehicle %>
<% end %>
<%= vehicles %>

	<script>

		function initMap() {
			console.log("inside initMap function");
			var toronto = {lat: 43.7184038, lng: -79.5181441};
			var map = new google.maps.Map(document.getElementById('map'), {
				zoom: 12,
				center: toronto
			});
			// function placeMarker(index, vehicle) {
			//
			// 	geocoder.geocode({'address': vehicle.innerHTML}, function(results, status) {
			// 		console.log(results);
			// 		console.log(status);
			// 		console.log(map);
			// 		map.setCenter(results[0].geometry.location);
			// 		var marker = new google.maps.Marker({
			// 			map: map,
			// 			position: results[0].geometry.location
			// 		});
			// 	});
			// }
			var geocoder = new google.maps.Geocoder();
			var vehicles = [];
			$.each($('.vehicle-address'), function placeMarker(index, vehicle) {
				vehicles.push(vehicle.innerHTML);
			});
			console.log(vehicles);
			var markers = [];
				for (var i = 0; i < vehicles.length; i++) {
					console.log(vehicles[i]);
				geocoder.geocode({'address': vehicles[i]}, function(results, status) {
					markers.push(results[0].geometry.location)
					console.log(results);
					console.log(status);
					console.log(map);
					map.setCenter(results[0].geometry.location);
					var marker = new google.maps.Marker({
						map: map,
						position: results[0].geometry.location

					});
					// markers.push(addMarker(map, results[0].geometry.location));
					// console.log(markers);
				});
				console.log(markers);
			}

			// function addMarker(map, location) {
			// 	var marker = new google.maps.Marker({
			// 		map: map,
			// 		position: location
			// 	});
			// 	return marker;
			// }
			// $.each($('.vehicle-address'), function(index, vehicle) {
			// 	console.log(vehicle);
			// });
			// var marker = new google.maps.Marker({
			// 	position: uluru,
			// 	map: map
			// });
			// console.log(geocoder);

		}
	</script>

<script async defer
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA-Sq6ZBy9oC33y1vxqvw6p42Yw-UUfwws&callback=initMap">
</script>
