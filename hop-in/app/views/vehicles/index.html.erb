<div class="vehicle-index">

<div class="vehicle-search">
	<%= form_tag vehicles_path, method: :get, class: "search-bar" do %>
	  <%= text_field_tag(
	      :search,
	      params[:search],
	      placeholder: "Where would you like to travel?",
	      class: "form-control"
	  ) %>
		 <%= submit_tag "Search", class: "btn btn-primary" %>
	<% end %>
</div>


<h1>Available Vehicles</h1>
<% if @vehicles.present? %>
<% else %>
	<p>No Vehicles :(</p>
<% end %>
	<% @vehicles.each do |vehicle| %>
		<article class="vehicle-container">
      <div class="vehicle-text">
  			<h2><%= vehicle.owner.first_name %>'s - <%= vehicle.vehicle_year %> <%= vehicle.vehicle_make %> <%= vehicle.vehicle_model %></h2>
  			<h3>Seats: <%= vehicle.seats %></h3>
  			<h3>Address: <span class="vehicle-address"><%= vehicle.street_address %>, <%= vehicle.city %></span></h3>
    		<ul ><li class='vehicle-link'><%= link_to 'Vehicle Page', vehicle_path(vehicle) %> </li>|<li class='vehicle-link'> <%= link_to 'Reserve Vehicle', new_vehicle_reservation_path(vehicle) %></li></ul>
      </div>
		</article>
	<% end %>
</div>
<h3 class="map-title">Vehicle Locator</h3>
<div id="map"></div>

	<script>
		function initMap() {
			var toronto = {lat: 43.7184038, lng: -79.5181441};
			var map = new google.maps.Map(document.getElementById('map'), {
				zoom: 12,
				center: toronto
			});

			var geocoder = new google.maps.Geocoder();
			var vehicles = [];
			$.each($('.vehicle-address'), function (index, vehicle) {
				vehicles.push(vehicle.innerHTML);
			});

			for (var i = 0; i < vehicles.length; i++) {
				geocoder.geocode({'address': vehicles[i]}, function(results, status) {
					if (status === 'OK') {
						map.setCenter(results[0].geometry.location);
						var marker = new google.maps.Marker({
							map: map,
							position: results[0].geometry.location
							});
					} else {
						alert('Geocode was not successful for the following reason: ' + status);
					}
				});
			}
		}
	</script>

<script async defer
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA-Sq6ZBy9oC33y1vxqvw6p42Yw-UUfwws&callback=initMap">
</script>
